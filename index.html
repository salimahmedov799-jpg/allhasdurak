<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Salim AI</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
*{box-sizing:border-box}

body{
  margin:0;
  font-family:'Inter',sans-serif;
  background:
    radial-gradient(circle at top, #0f172a, #000 60%),
    linear-gradient(180deg,#000,#020617);
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

.chat{
  width:100%;
  max-width:420px;
  height:92vh;
  background:rgba(0,0,0,.6);
  backdrop-filter:blur(18px);
  display:flex;
  flex-direction:column;
  border-radius:22px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,.08);
}

.header{
  padding:14px 16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid rgba(255,255,255,.06);
}

.header-title{font-weight:700;font-size:16px}

.clear-btn{
  background:none;border:none;color:#f87171;
  font-size:18px;cursor:pointer
}

.messages{
  flex:1;padding:16px;overflow-y:auto;
  scrollbar-width:none
}
.messages::-webkit-scrollbar{display:none}

.msg{
  margin-bottom:14px;
  padding:12px 15px;
  border-radius:16px;
  max-width:80%;
  font-size:14.5px;
  line-height:1.45;
}

.user{
  margin-left:auto;
  background:linear-gradient(135deg,#2563eb,#3b82f6);
}

.bot{
  background:rgba(15,23,42,.9);
  border:1px solid rgba(255,255,255,.08);
}

.msg img{
  max-width:100%;
  border-radius:12px;
  margin-top:6px;
}

.input{
  display:flex;
  padding:12px;
  gap:8px;
  border-top:1px solid rgba(255,255,255,.06);
}

input[type="text"]{
  flex:1;
  padding:14px;
  border-radius:16px;
  border:none;
  background:rgba(255,255,255,.08);
  color:#fff;
  outline:none;
}

button{
  padding:0 14px;
  border-radius:16px;
  border:none;
  cursor:pointer;
  font-size:18px;
}

#sendBtn{
  background:linear-gradient(135deg,#22c55e,#16a34a);
}
#voiceBtn,#imageBtn{
  background:rgba(255,255,255,.08);
  color:#fff;
}
</style>
</head>

<body>

<div class="chat">
  <div class="header">
    <div class="header-title">üöÄ Salim AI</div>
    <button class="clear-btn" onclick="clearAll()">üßπ</button>
  </div>

  <div class="messages" id="messages"></div>

  <div class="input">
    <button id="imageBtn">üì∑</button>
    <input type="file" id="imageInput" accept="image/*" hidden>
    <input type="text" id="text" placeholder="–ù–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ..." />
    <button id="voiceBtn">üé§</button>
    <button id="sendBtn">‚û§</button>
  </div>
</div>

<script>
const messages=document.getElementById("messages");
const input=document.getElementById("text");
const imageInput=document.getElementById("imageInput");

let imageBase64=null;

function add(content,role){
  const d=document.createElement("div");
  d.className="msg "+role;
  if(typeof content==="string") d.textContent=content;
  else d.appendChild(content);
  messages.appendChild(d);
  messages.scrollTop=messages.scrollHeight;
}

document.getElementById("imageBtn").onclick=()=>imageInput.click();

imageInput.onchange=()=>{
  const file=imageInput.files[0];
  if(!file)return;

  const reader=new FileReader();
  reader.onload=()=>{
    imageBase64=reader.result;
    const img=document.createElement("img");
    img.src=imageBase64;
    add(img,"user");
  };
  reader.readAsDataURL(file);
};

async function send(){
  const text=input.value.trim();
  if(!text && !imageBase64)return;

  if(text) add(text,"user");
  input.value="";

  add("Salim AI –¥—É–º–∞–µ—Ç...","bot");

  try{
    let res,data;

    if(imageBase64){
      res=await fetch("https://salim-ai.onrender.com/api/vision",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({
          image:imageBase64,
          prompt:text||"–ß—Ç–æ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏?"
        })
      });
    }else{
      res=await fetch("https://salim-ai.onrender.com/api/chat",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({message:text})
      });
    }

    data=await res.json();
    messages.lastChild.textContent=data.reply||"–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞";

  }catch{
    messages.lastChild.textContent="–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è";
  }

  imageBase64=null;
}

document.getElementById("sendBtn").onclick=send;

/* üé§ –≥–æ–ª–æ—Å */
const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
if(SR){
  const r=new SR();
  r.lang="ru-RU";
  document.getElementById("voiceBtn").onclick=()=>r.start();
  r.onresult=e=>input.value=e.results[0][0].transcript;
}

function clearAll(){
  if(!confirm("–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç?"))return;
  messages.innerHTML="";
}
</script>

</body>
</html>
