<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Salim AI</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

*{box-sizing:border-box}

body{
  margin:0;
  font-family:'Inter',sans-serif;
  background:
    radial-gradient(circle at top, #0f172a, #000 60%),
    linear-gradient(180deg,#000,#020617);
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

/* APP */
.chat{
  width:100%;
  max-width:420px;
  height:92vh;
  background:rgba(0,0,0,.6);
  backdrop-filter:blur(18px);
  display:flex;
  flex-direction:column;
  border-radius:22px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,.08);
  box-shadow:0 20px 60px rgba(0,0,0,.6);
}

/* HEADER */
.header{
  padding:14px 16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:rgba(0,0,0,.6);
  border-bottom:1px solid rgba(255,255,255,.06);
}

.header-title{
  font-weight:700;
  font-size:16px;
  letter-spacing:.3px;
}

.clear-btn{
  background:none;
  border:none;
  color:#f87171;
  font-size:18px;
  cursor:pointer;
  transition:.2s;
}
.clear-btn:hover{transform:scale(1.1)}

/* MESSAGES */
.messages{
  flex:1;
  padding:16px;
  overflow-y:auto;
  scrollbar-width:none;
}
.messages::-webkit-scrollbar{display:none}

/* MESSAGE */
.msg{
  margin-bottom:14px;
  padding:12px 15px;
  border-radius:16px;
  max-width:80%;
  font-size:14.5px;
  line-height:1.45;
  animation:fadeUp .25s ease;
}

@keyframes fadeUp{
  from{opacity:0;transform:translateY(6px)}
  to{opacity:1;transform:none}
}

.user{
  margin-left:auto;
  background:linear-gradient(135deg,#2563eb,#3b82f6);
  border-bottom-right-radius:6px;
  box-shadow:0 6px 20px rgba(59,130,246,.35);
}

.bot{
  background:rgba(15,23,42,.9);
  border:1px solid rgba(255,255,255,.08);
  border-bottom-left-radius:6px;
}

/* INPUT */
.input{
  display:flex;
  padding:12px;
  gap:8px;
  background:rgba(0,0,0,.65);
  border-top:1px solid rgba(255,255,255,.06);
}

input{
  flex:1;
  padding:14px;
  border-radius:16px;
  border:none;
  background:rgba(255,255,255,.08);
  color:#fff;
  outline:none;
  font-size:14.5px;
}

input::placeholder{color:#9ca3af}

button{
  padding:0 14px;
  border-radius:16px;
  border:none;
  cursor:pointer;
  font-size:18px;
  transition:.2s;
}

#voiceBtn{
  background:rgba(255,255,255,.08);
  color:#fff;
}

#sendBtn{
  background:linear-gradient(135deg,#22c55e,#16a34a);
  color:#000;
  box-shadow:0 6px 18px rgba(34,197,94,.35);
}

button:hover{transform:scale(1.05)}
</style>
</head>

<body>

<div class="chat">
  <div class="header">
    <div class="header-title">ðŸš€ Salim AI</div>
    <button class="clear-btn" onclick="clearAll()">ðŸ§¹</button>
  </div>

  <div class="messages" id="messages"></div>

  <div class="input">
    <input id="text" placeholder="ÐÐ°Ð¿Ð¸ÑˆÐ¸ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ..." />
    <button id="voiceBtn">ðŸŽ¤</button>
    <button id="sendBtn">âž¤</button>
  </div>
</div>

<script>
const messages = document.getElementById("messages");
const input = document.getElementById("text");

/* ðŸ§  ÐžÐ‘Ð«Ð§ÐÐÐ¯ ÐŸÐÐœÐ¯Ð¢Ð¬ */
let memory = JSON.parse(localStorage.getItem("salim_chat")) || [];

/* ðŸ§  Ð£ÐœÐÐÐ¯ ÐŸÐÐœÐ¯Ð¢Ð¬ */
let smartMemory = JSON.parse(localStorage.getItem("salim_smart")) || [];

function saveAll(){
  localStorage.setItem("salim_chat",JSON.stringify(memory));
  localStorage.setItem("salim_smart",JSON.stringify(smartMemory));
}

function add(text,role,save=true){
  const d=document.createElement("div");
  d.className="msg "+role;
  d.textContent=text;
  messages.appendChild(d);
  messages.scrollTop=messages.scrollHeight;
  if(save){
    memory.push({role,text});
    saveAll();
  }
}

/* Ð’ÐžÐ¡Ð¡Ð¢ÐÐÐžÐ’Ð›Ð•ÐÐ˜Ð• */
memory.forEach(m=>add(m.text,m.role,false));

/* ðŸ§  ÐÐÐÐ›Ð˜Ð— Ð’ÐÐ–ÐÐžÐ™ Ð˜ÐÐ¤ÐžÐ ÐœÐÐ¦Ð˜Ð˜ */
function detectSmartMemory(text){
  const patterns=[
    /Ð¼ÐµÐ½Ñ Ð·Ð¾Ð²ÑƒÑ‚ (.+)/i,
    /Ð¼Ð¾Ðµ Ð¸Ð¼Ñ (.+)/i,
    /Ñ Ð»ÑŽÐ±Ð»ÑŽ (.+)/i,
    /Ð·Ð°Ð¿Ð¾Ð¼Ð½Ð¸,? Ñ‡Ñ‚Ð¾ (.+)/i,
    /Ñ Ð¶Ð¸Ð²Ñƒ Ð² (.+)/i
  ];
  patterns.forEach(p=>{
    const m=text.match(p);
    if(m){
      smartMemory.push(m[0]);
      saveAll();
    }
  });
}

async function send(){
  const text=input.value.trim();
  if(!text)return;

  add(text,"user");
  detectSmartMemory(text);
  input.value="";

  add("Salim AI Ð´ÑƒÐ¼Ð°ÐµÑ‚...","bot");

  const context = smartMemory.length
    ? "Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ðµ: "+smartMemory.join("; ")
    : "";

  try{
    const res=await fetch("https://salim-ai.onrender.com/api/chat",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({
        message: context + "\n" + text
      })
    });
    const data=await res.json();
    messages.lastChild.textContent=data.reply||"ÐÐµÑ‚ Ð¾Ñ‚Ð²ÐµÑ‚Ð° ðŸ˜•";
    memory[memory.length-1].text=data.reply;
    saveAll();
  }catch{
    messages.lastChild.textContent="ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ âŒ";
  }
}

document.getElementById("sendBtn").onclick=send;

/* ðŸ§¹ ÐŸÐžÐ›ÐÐÐ¯ ÐžÐ§Ð˜Ð¡Ð¢ÐšÐ */
function clearAll(){
  if(!confirm("ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ Ð²ÑÑŽ Ð¿Ð°Ð¼ÑÑ‚ÑŒ?"))return;
  localStorage.clear();
  memory=[];
  smartMemory=[];
  messages.innerHTML="";
}

/* ðŸŽ¤ Ð“ÐžÐ›ÐžÐ¡ */
const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
if(SR){
  const r=new SR();
  r.lang="ru-RU";
  document.getElementById("voiceBtn").onclick=()=>r.start();
  r.onresult=e=>input.value=e.results[0][0].transcript;
}
</script>

</body>
</html>
